{"version":3,"file":"background.js","sources":["../src/auto-updater.ts","../background.ts"],"sourcesContent":["import { log } from \"./log\";\n\nexport const initAutoUpdater = () => {\n  log(\"initAutoUpdater\");\n  const loop = async () => {\n    const currentTS = await fetch(\"./.timestamp\").then((_) => _.json());\n\n    while (true) {\n      log(\"checking for updates...\");\n      const newTS = await fetch(\"./.timestamp\")\n        .then((_) => _.json())\n        .catch(() => \"unknown\");\n      if (newTS === \"unknown\" || newTS === currentTS) {\n        await new Promise((resolve) => setTimeout(resolve, 1000));\n      } else {\n        log(`new update found! ${new Date(currentTS)} -> ${new Date(newTS)}`);\n        chrome.runtime.reload();\n        return;\n      }\n    }\n  };\n\n  loop();\n};\n","import { initAutoUpdater } from \"./src/auto-updater\";\nimport { log } from \"./src/log\";\nimport { ClientMessage } from \"./src/extension-message\";\nlog(\"init\");\n\nchrome.storage.local.get([\"is-first-run\"], (result) => {\n  if (result[\"is-first-run\"] === undefined) {\n    log(\"first run, opening first-run.html\");\n    chrome.storage.local.set({ \"is-first-run\": true });\n    chrome.tabs.create({ url: chrome.runtime.getURL(\"first-run.html\") });\n\n    return;\n  }\n\n  log(\"not first run, skipping first-run.html\");\n});\n\ninitAutoUpdater();\n\nchrome.runtime.onMessage.addListener(function (request: ClientMessage, sender) {\n  if (request.type === \"action:update-badge\") {\n    if (request.text) {\n      chrome.action.setBadgeText({\n        text: request.text,\n        tabId: sender.tab?.id,\n      });\n    }\n\n    if (request.color) {\n      chrome.action.setBadgeBackgroundColor({\n        color: request.color,\n        tabId: sender.tab?.id,\n      });\n    }\n  }\n\n  return true;\n});\n"],"names":["initAutoUpdater","log","currentTS","fetch","then","_","json","newTS","catch","Promise","resolve","setTimeout","Date","chrome","runtime","reload","storage","local","get","result","undefined","set","tabs","create","url","getURL","onMessage","addListener","request","sender","type","text","action","setBadgeText","tabId","tab","id","color","setBadgeBackgroundColor"],"mappings":"6BAEO,MAAMA,EAAkBA,IAAM,CACnCC,EAAI,iBAAiB,GACR,SAAY,CACjBC,MAAAA,EAAY,MAAMC,MAAM,cAAc,EAAEC,KAAMC,GAAMA,EAAEC,KAAAA,CAAM,EAElE,OAAa,CACXL,EAAI,yBAAyB,EAC7B,MAAMM,EAAQ,MAAMJ,MAAM,cAAc,EACrCC,KAAYC,GAAAA,EAAEC,KAAM,CAAA,EACpBE,MAAM,IAAM,SAAS,EACpBD,GAAAA,IAAU,WAAaA,IAAUL,EACnC,MAAM,IAAIO,QAASC,GAAYC,WAAWD,EAAS,GAAI,CAAC,MACnD,CACAT,EAAA,qBAAoB,IAAIW,KAAKV,CAAS,QAAQ,IAAIU,KAAKL,CAAK,GAAG,EACpEM,OAAOC,QAAQC,SACf,QAEJ,IAIJ,ECpBAd,EAAI,MAAM,EAEVY,OAAOG,QAAQC,MAAMC,IAAI,CAAC,cAAc,EAAeC,GAAA,CACjDA,GAAAA,EAAO,cAAc,IAAMC,OAAW,CACxCnB,EAAI,mCAAmC,EAChCe,OAAAA,QAAQC,MAAMI,IAAI,CAAE,eAAgB,EAAA,CAAM,EACjDR,OAAOS,KAAKC,OAAO,CAAEC,IAAKX,OAAOC,QAAQW,OAAO,gBAAgB,CAAA,CAAG,EAEnE,OAGFxB,EAAI,wCAAwC,CAC9C,CAAC,EAEDD,IAEAa,OAAOC,QAAQY,UAAUC,YAAY,SAAUC,EAAwBC,EAAQ,SACzED,OAAAA,EAAQE,OAAS,wBACfF,EAAQG,MACVlB,OAAOmB,OAAOC,aAAa,CACzBF,KAAMH,EAAQG,KACdG,OAAOL,EAAAA,EAAOM,MAAPN,YAAAA,EAAYO,EAAAA,CACpB,EAGCR,EAAQS,OACVxB,OAAOmB,OAAOM,wBAAwB,CACpCD,MAAOT,EAAQS,MACfH,OAAOL,EAAAA,EAAOM,MAAPN,YAAAA,EAAYO,EAAAA,CACpB,GAIE,EACT,CAAC"}